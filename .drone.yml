---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:
  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  # Coverage not implemented yet
  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  #- name: docker
  #  image: plugins/docker
  #  settings:
  #    repo: quay.io/natlibfi/melinda-record-update-controller
  #    registry: quay.io
  #    username:
  #      from_secret: docker_username
  #    password:
  #      from_secret: docker_password
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: docker_username
data: -
---
kind: secret
name: docker_password
data: -
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
...
